unbind C-b
set-option -g prefix C-space

bind r source-file ~/.config/tmux/tmux.conf

# Better pane handling
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R
bind -n -r C-M-h resize-pane -L
bind -n -r C-M-j resize-pane -D
bind -n -r C-M-k resize-pane -U
bind -n -r C-M-l resize-pane -R

set -g mouse on

setw -g mode-keys vi

# Fix vim taking a while to register ESC when in tmux
set -s escape-time 0

# Fix colours being weird in alacritty
set -g default-terminal "screen-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# I don't know if the following lines actually do anything
# https://dev.to/anurag_pramanik/how-to-enable-undercurl-in-neovim-terminal-and-tmux-setup-guide-2ld7
# Undercurl
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
# Colours for undercurl
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# estimated 10Mb ram per pane
# Should be fine for memory usage
set -g history-limit 100000

# Fix weird clipboard issues
bind-key -T copy-mode-vi y send-keys -X copy-pipe "xclip -selection clipboard -i"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"
bind-key -T copy-mode-vi C-MouseDragEnd1Pane send-keys -X copy-pipe "xclip -selection clipboard -i"
bind-key -T copy-mode-vi DoubleClick1Pane \
    select-pane \; \
    send-keys -X select-word \; \
    run-shell "sleep 0.2 && tmux send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard -i'"
bind-key -n DoubleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-word \; \
    run-shell "sleep 0.2 && tmux send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard -i'"
bind-key -T copy-mode-vi TripleClick1Pane \
    select-pane \; \
    send-keys -X select-line \; \
    run-shell "sleep 0.2 && tmux send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard -i'"
bind-key -n TripleClick1Pane \
    select-pane \; \
    copy-mode -M \; \
    send-keys -X select-line \; \
    run-shell "sleep 0.2 && tmux send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard -i'"

# better split bindings
bind c new-window -c "#{pane_current_path}"
unbind s
bind s split-window -c "#{pane_current_path}"
bind a split-window -h -c "#{pane_current_path}"

# Yazi images
set -g allow-passthrough on
set -g visual-activity off
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM

# Navi
bind-key -N "Open Navi (cheat sheets)" -T prefix C-g split-window \
  "$SHELL --login -i -c 'navi --print | tmux load-buffer -b tmp - ; tmux paste-buffer -p -t {last} -b tmp -d'"

